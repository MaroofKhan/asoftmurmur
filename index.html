<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<title>A Soft Murmur</title>
<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="js/jquery.mobile.custom.structure.min.css" />
<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/jquery.mobile.custom.min.js"></script>

<link rel="icon" href="favicon.png">
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-42700626-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type="text/javascript">

$(document).ready(function() {

var rainslider = $("#rain-slider");
var wavesslider = $("#waves-slider");
var thunderslider = $("#thunder-slider");
var fireslider = $("#fire-slider");
var birdsslider = $("#birds-slider");
var humansslider = $("#humans-slider");

var rainbackground = $("#rain-slider-background");
var wavesbackground = $("#waves-slider-background");
var thunderbackground = $("#thunder-slider-background");
var firebackground = $("#fire-slider-background");
var birdsbackground = $("#birds-slider-background");
var humansbackground = $("#humans-slider-background");

var rainplayer0 = $('#rainplayer')[0]; 
var rainglueplayer0 = $('#rainglueplayer')[0];
var wavesplayer0 = $('#wavesplayer')[0];
var wavesglueplayer0 = $('#wavesglueplayer')[0];
var thunderplayer0 = $('#thunderplayer')[0];
var thunderglueplayer0 = $('#thunderglueplayer')[0];
var fireplayer0 = $('#fireplayer')[0];
var fireglueplayer0 = $('#fireglueplayer')[0];
var birdsplayer0 = $('#birdsplayer')[0];
var birdsglueplayer0 = $('#birdsglueplayer')[0];
var humansplayer0 = $('#humansplayer')[0];
var humansglueplayer0 = $('#humansglueplayer')[0];

var rainplayer = $('#rainplayer'); 
var rainglueplayer = $('#rainglueplayer');
var wavesplayer = $('#wavesplayer');
var wavesglueplayer = $('#wavesglueplayer');
var thunderplayer = $('#thunderplayer');
var thunderglueplayer = $('#thunderglueplayer');
var fireplayer = $('#fireplayer');
var fireglueplayer = $('#fireglueplayer');
var birdsplayer = $('#birdsplayer');
var birdsglueplayer = $('#birdsglueplayer');
var humansplayer = $('#humansplayer');
var humansglueplayer = $('#humansglueplayer');


var ppbutton = $("#play-pause-button");
    
  function playif(player, glueplayer){
      if(player.volume > 0.02) {
        player.play();     
        if(player.currentTime < 0.01) {
          glueplayer.currentTime = 7;
          glueplayer.play();      
        }
      }
        
  }
  
  function playall(){
    playif(rainplayer0, rainglueplayer0);
    playif(wavesplayer0, wavesglueplayer0);
    playif(thunderplayer0, thunderglueplayer0);
    playif(fireplayer0, fireglueplayer0);
    playif(birdsplayer0, birdsglueplayer0);          
    playif(humansplayer0, humansglueplayer0);
  }
  
  function pauseall(){
    rainplayer0.pause();
    rainglueplayer0.pause();
    wavesplayer0.pause();
    wavesglueplayer0.pause();
    thunderplayer0.pause();
    thunderglueplayer0.pause();
    fireplayer0.pause();
    fireglueplayer0.pause();
    birdsplayer0.pause();
    birdsglueplayer0.pause();          
    humansplayer0.pause();
    humansglueplayer0.pause();
  }  
  
//play-all and pause-all function

  function slidervol(player, glueplayer, slider, sliderbackground) {
    player.volume = slider.val();
    glueplayer.volume = slider.val();
    sliderbackground.css({'opacity': slider.val() });
      if(player.volume > 0.02 && $("#play-pause-button").hasClass('pause-all')) {
        player.play();
      }
      if(player.volume > 0.02 && $("#play-pause-button").hasClass('pause-all') && player.currentTime <0.01 && glueplayer.paused){
        glueplayer.currentTime = 7;
        glueplayer.play();      
      }
// this plays half of glueplayer while the main audio element loads      
      if(player.volume <= 0.02) {
        player.pause();
      }
      if(glueplayer.volume <= 0.02) {
        glueplayer.pause();
      }
  }
  
  function remembervol(slider, lsvol) {
    localStorage.setItem(lsvol, slider.val());
  }
  
// function updates volume at load and when slider moves and sets localstorage
  

  var lastrainvol = localStorage.getItem("lsrain");
      if (typeof lastrainvol != "object"){ 
        rainslider.val(lastrainvol);
        rainslider.slider("refresh");
      }
      
  slidervol(rainplayer0, rainglueplayer0, rainslider, rainbackground);
    
  rainslider.on( 'change', function( event, ui ) {
    slidervol(rainplayer0, rainglueplayer0, rainslider, rainbackground);
    remembervol(rainslider, "lsrain");
  })
  
  var lastwavesvol = localStorage.getItem("lswaves");
      if (typeof lastwavesvol != "object"){ 
        wavesslider.val(lastwavesvol);
        wavesslider.slider("refresh");
      }  

  slidervol(wavesplayer0, wavesglueplayer0, wavesslider, wavesbackground);

  wavesslider.on( 'change', function( event, ui ) {
    slidervol(wavesplayer0, wavesglueplayer0, wavesslider, wavesbackground);
    remembervol(wavesslider, "lswaves");    
  })  

  var lastthundervol = localStorage.getItem("lsthunder");
      if (typeof lastthundervol != "object"){ 
        thunderslider.val(lastthundervol);
        thunderslider.slider("refresh");
      }
  
  slidervol(thunderplayer0, thunderglueplayer0, thunderslider, thunderbackground);
  
  thunderslider.on( 'change', function( event, ui ) {
    slidervol(thunderplayer0, thunderglueplayer0, thunderslider, thunderbackground);
    remembervol(thunderslider, "lsthunder");
  })  

  var lastfirevol = localStorage.getItem("lsfire");
      if (typeof lastfirevol != "object"){ 
        fireslider.val(lastfirevol);
        fireslider.slider("refresh");
      }

  slidervol(fireplayer0, fireglueplayer0, fireslider, firebackground);
  
  fireslider.on( 'change', function( event, ui ) {
    slidervol(fireplayer0, fireglueplayer0, fireslider, firebackground);
    remembervol(fireslider, "lsfire");
  }) 

  var lastbirdsvol = localStorage.getItem("lsbirds");
      if (typeof lastbirdsvol != "object"){ 
        birdsslider.val(lastbirdsvol);
        birdsslider.slider("refresh");
      }

  slidervol(birdsplayer0, birdsglueplayer0, birdsslider, birdsbackground);
  
  birdsslider.on( 'change', function( event, ui ) {
    slidervol(birdsplayer0, birdsglueplayer0, birdsslider, birdsbackground);
    remembervol(birdsslider, "lsbirds");
  }) 

  var lasthumansvol = localStorage.getItem("lshumans");
      if (typeof lasthumansvol != "object"){ 
        humansslider.val(lasthumansvol);
        humansslider.slider("refresh");
      }

  slidervol(humansplayer0, humansglueplayer0, humansslider, humansbackground);
  
  humansslider.on( 'change', function( event, ui ) {
    slidervol(humansplayer0, humansglueplayer0, humansslider, humansbackground);
    remembervol(humansslider, "lshumans");
  })   
  
// parameters to update audio by slider

  function sloop(player, otherPlayer, time) {
    if (player.currentTime >= time && otherPlayer.paused && !player.paused){
      otherPlayer.currentTime = 0;
      otherPlayer.play();
    }
  }
  
// function to fake seamless looping

  rainplayer.bind('timeupdate', function() {
    sloop(rainplayer0, rainglueplayer0, 294);
  })

  rainglueplayer.bind('timeupdate', function() {
    sloop(rainglueplayer0, rainplayer0, 5);
  })
  
  wavesplayer.bind('timeupdate', function() {
    sloop(wavesplayer0, wavesglueplayer0, 234);
  })

  wavesglueplayer.bind('timeupdate', function() {
    sloop(wavesglueplayer0, wavesplayer0, 5);
  })
  
  thunderplayer.bind('timeupdate', function() {
    sloop(thunderplayer0, thunderglueplayer0, 294);
  })

  thunderglueplayer.bind('timeupdate', function() {
    sloop(thunderglueplayer0, thunderplayer0, 5);
  })
  
  fireplayer.bind('timeupdate', function() {
    sloop(fireplayer0, fireglueplayer0, 234);
  })

  fireglueplayer.bind('timeupdate', function() {
    sloop(fireglueplayer0, fireplayer0, 5);
  })

  birdsplayer.bind('timeupdate', function() {
    sloop(birdsplayer0, birdsglueplayer0, 294);
  })

  birdsglueplayer.bind('timeupdate', function() {
    sloop(birdsglueplayer0, birdsplayer0, 5);
  })    
  
  humansplayer.bind('timeupdate', function() {
    sloop(humansplayer0, humansglueplayer0, 141);
  })

  humansglueplayer.bind('timeupdate', function() {
    sloop(humansglueplayer0, humansplayer0, 5);
  })  

// looping parameters for each sample

$('label').on('click', false);

// prevent tap bringing up input dialogue on mobile devices

$(window).load(function(){

  $("#loading").css("display", "none"); 
  $("#all-controls").css("display", "inline");

  ppbutton.click(function(){
      if($(this).hasClass('play-all')) {
        playall();               
        $(this).attr("class", "pause-all");
      }
      else {
        pauseall();            
        $(this).attr("class", "play-all");
      }
  })

  wavesplayer.attr("preload", "auto");
  rainplayer.attr("preload", "auto");
  thunderplayer.attr("preload", "auto");  
  fireplayer.attr("preload", "auto");
  birdsplayer.attr("preload", "auto");
  humansplayer.attr("preload", "auto");  

})

})
</script>
</head>

<body data-role="none">
<div id="page-container">

<div id="share-buttons">
  <span id="facebook"><a href="http://www.facebook.com/sharer/sharer.php?s=100&p[url]=http://asoftmurmur.com&p[images][0]=&p[title]=A%20Soft%20Murmur&p[summary]=Relaxing%20ambient%20background%20noise" target="_blank">Facebook</a></span><span id="twitter"><a href="http://twitter.com/home?status=I'm%20enjoying%20relaxing%20ambient%20background%20noise%20from%20asoftmurmur.com%20@asoftmurmur" target="_blank">Twitter</a></span><span id="googleplus"><a href="https://plus.google.com/share?url=http://asoftmurmur.com" target="_blank">Google+</a></span>
</div>

<div id="site-title">
  <h1>A SOFT MURMUR</h1>
</div>

<div id="intro-text">
  <p>Ambient sounds to wash away distraction.</p>
</div>

<div id="all-controls">
  <div id="play-pause-container">
    <a href="#">
      <div id="play-pause-button" class="play-all"></div>
    </a>
  </div>
</div>
<div id="loading">
  <p>Loading...</p>
</div>

<div id="sliders-container">

<div id="rain-slider-container" class="sliders">
  <div id="rain-slider-background" class="slider-background"></div>
  <div id="rain-slider-container-inner" class="slider-inner">
    <div class="labelfix"> <label for="rain-slider">Rain</label> </div>
      <input type="range" id="rain-slider" value="0.3" min="0" max="1" step="0.001" class="ui-hidden-accessible"/>
  </div>
</div>

<div id="thunder-slider-container" class="sliders">
  <div id="thunder-slider-background" class="slider-background"></div>
  <div id="thunder-slider-container-inner" class="slider-inner">
    <div class="labelfix"> <label for="thunder-slider">Thunder</label> </div>
      <input type="range" id="thunder-slider" value="0.8" min="0" max="1" step="0.001" class="ui-hidden-accessible"/>
  </div>
</div>

<div id="fire-slider-container" class="sliders">
  <div id="fire-slider-background" class="slider-background"></div>
  <div id="fire-slider-container-inner" class="slider-inner">
    <div class="labelfix"> <label for="fire-slider">Fire</label> </div>
      <input type="range" id="fire-slider" value="0.4" min="0" max="1" step="0.001" class="ui-hidden-accessible"/>
  </div>
</div>

<div id="waves-slider-container" class="sliders">
  <div id="waves-slider-background" class="slider-background"></div>
  <div id="waves-slider-container-inner" class="slider-inner">
    <div class="labelfix"> <label for="waves-slider">Waves</label> </div>
      <input type="range" id="waves-slider" value="0.0" min="0" max="1" step="0.001" class="ui-hidden-accessible"/>
  </div>
</div>

<div id="birds-slider-container" class="sliders">
  <div id="birds-slider-background" class="slider-background"></div>
  <div id="birds-slider-container-inner" class="slider-inner">
    <div class="labelfix"> <label for="birds-slider">Birds</label> </div>
      <input type="range" id="birds-slider" value="0.0" min="0" max="1" step="0.001" class="ui-hidden-accessible"/>
  </div>
</div>

<div id="humans-slider-container" class="sliders">
  <div id="humans-slider-background" class="slider-background"></div>
  <div id="humans-slider-container-inner" class="slider-inner">
    <div class="labelfix"> <label for="humans-slider">Humans</label> </div>
      <input type="range" id="humans-slider" value="0.0" min="0" max="1" step="0.001" class="ui-hidden-accessible"/>
  </div>
</div>

</div>

<div id="image-preload-1">
</div>

<div id="image-preload-2">
</div>

<div id="footer">
  <p><a href="info.html" data-ajax="false" target="_blank">About</a></p>
</div>

<!-- Audio players without controls -->

<div class="audioplayer">
  <audio id="wavesplayer" loop preload="none">
    <source src="audio/waves.fade.mp4" type="audio/mp4" />
    <source src="audio/waves.fade.ogg" type="audio/ogg" />
  </audio>
</div>

<div class="audioplayer">
  <audio id="wavesglueplayer" preload="auto">
    <source src="audio/waves.glue.mp4" type="audio/mp4" />
    <source src="audio/waves.glue.ogg" type="audio/ogg" />
  </audio>
</div>

<div class="audioplayer">
  <audio id="rainplayer" loop preload="none">
    <source src="audio/rain.fade.mp4" type="audio/mp4">
    <source src="audio/rain.fade.ogg" type="audio/ogg">
  </audio>
</div>

<div class="audioplayer">
  <audio id="rainglueplayer" preload="auto">
    <source src="audio/rain.glue.mp4" type="audio/mp4">
    <source src="audio/rain.glue.ogg" type="audio/ogg">
  </audio>
</div>

<div class="audioplayer">
  <audio id="thunderplayer" loop preload="none">
    <source src="audio/thunder.fade.mp4" type="audio/mp4">
    <source src="audio/thunder.fade.ogg" type="audio/ogg">
  </audio>
</div>

<div class="audioplayer">
  <audio id="thunderglueplayer" preload="auto">
    <source src="audio/thunder.glue.mp4" type="audio/mp4">
    <source src="audio/thunder.glue.ogg" type="audio/ogg">
  </audio>
</div>

<div class="audioplayer">
  <audio id="fireplayer" loop preload="none">
    <source src="audio/fire.fade.mp4" type="audio/mp4">
    <source src="audio/fire.fade.ogg" type="audio/ogg">
  </audio>
</div>

<div class="audioplayer">
  <audio id="fireglueplayer" preload="auto">
    <source src="audio/fire.glue.mp4" type="audio/mp4">
    <source src="audio/fire.glue.ogg" type="audio/ogg">
  </audio>
</div>

<div class="audioplayer">
  <audio id="birdsplayer" loop preload="none">
    <source src="audio/birds.fade.mp4" type="audio/mp4">
    <source src="audio/birds.fade.ogg" type="audio/ogg">
  </audio>
</div>

<div class="audioplayer">
  <audio id="birdsglueplayer" preload="auto">
    <source src="audio/birds.glue.mp4" type="audio/mp4">
    <source src="audio/birds.glue.ogg" type="audio/ogg">
  </audio>
</div>

<div class="audioplayer">
  <audio id="humansplayer" loop preload="none">
    <source src="audio/humans.fade.mp4" type="audio/mp4">
    <source src="audio/humans.fade.ogg" type="audio/ogg">
  </audio>
</div>

<div class="audioplayer">
  <audio id="humansglueplayer" preload="auto">
    <source src="audio/humans.glue.mp4" type="audio/mp4">
    <source src="audio/humans.glue.ogg" type="audio/ogg">
  </audio>
</div>

<!-- end audio players -->

</div>
</body>
</html>